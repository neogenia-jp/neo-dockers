upstream redmine {
        server localhost:3000;
}

server {
        server_name  localhost revproxy;
        listen       80;

        location ^~ /.well-known/acme-challenge/ {
                root /var/www/letsencrypt;
        }

        location / {
                return 301   https://$host$request_uri;
        }
}

server {
        server_name  localhost revproxy;

        listen       443 ssl http2;
        ssl_certificate      /etc/letsencrypt/live/@APP_DOMAIN@/fullchain.pem;
        ssl_certificate_key  /etc/letsencrypt/live/@APP_DOMAIN@/privkey.pem;

        client_max_body_size 100M;

        error_page   500 502 503 504  /50x.html;

        location = /50x.html {
                root   /var/www/html;
        }

        location = /robots.txt {
                root   /var/www/html;
                log_not_found off;
                access_log off;
        }

        location / {
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header Host $http_host;
                proxy_pass http://redmine;
        }
}
